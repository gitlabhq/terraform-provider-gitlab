---
# generated by https://github.com/hashicorp/terraform-plugin-docs
page_title: "gitlab_group_protected_environment Resource - terraform-provider-gitlab"
subcategory: ""
description: |-
  The gitlab_group_protected_environment resource allows to manage the lifecycle of a protected environment in a group.
  ~> In order to use a user_id in the deploy_access_levels configuration,
  you need to make sure that users have access to the group with Maintainer role or higher.
  In order to use a group_id in the deploy_access_levels configuration,
  the group_id must be a sub-group under the given group.
  Upstream API: GitLab REST API docs https://docs.gitlab.com/ee/api/group_protected_environments.html
---

# gitlab_group_protected_environment (Resource)

The `gitlab_group_protected_environment` resource allows to manage the lifecycle of a protected environment in a group.

~> In order to use a user_id in the `deploy_access_levels` configuration,
   you need to make sure that users have access to the group with Maintainer role or higher.
   In order to use a group_id in the `deploy_access_levels` configuration,
   the group_id must be a sub-group under the given group.

**Upstream API**: [GitLab REST API docs](https://docs.gitlab.com/ee/api/group_protected_environments.html)

## Example Usage

```terraform
# Example with deployment access level
resource "gitlab_group_protected_environment" "example_with_access_level" {
  group       = 12345
  environment = "production"

  deploy_access_levels = [
    {
      access_level = "developer"
    }
  ]
}

# Example with group-based deployment level
resource "gitlab_group_protected_environment" "example_with_group" {
  group       = 12345
  environment = "staging"

  deploy_access_levels = [
    {
      group_id = 456
    }
  ]
}

# Example with user-based deployment level
resource "gitlab_group_protected_environment" "example_with_user" {
  group       = 12345
  environment = "other"

  deploy_access_levels = [
    {
      user_id = 789
    }
  ]
}

# Example with multiple deployment access levels
resource "gitlab_group_protected_environment" "example_with_multiple" {
  group       = 12345
  environment = "development"

  deploy_access_levels = [
    {
      access_level       = "developer"
      required_approvals = 2
    },
    {
      group_id = 456
    },
    {
      user_id = 789
    }
  ]
}

# Example with access-level based approval rules
resource "gitlab_group_protected_environment" "example_with_multiple" {
  group       = 12345
  environment = "testing"

  deploy_access_levels = [
    {
      access_level = "developer"
    }
  ]

  approval_rules = [
    {
      access_level       = "developer"
      required_approvals = 2
    }
  ]
}

# Example with multiple approval rules, using access level, user, and group
resource "gitlab_group_protected_environment" "example_with_multiple" {
  group       = 12345
  environment = "production"

  deploy_access_levels = [
    {
      access_level = "developer"
    }
  ]

  approval_rules = [
    {
      user_id = 789
    },
    {
      access_level       = "developer"
      required_approvals = 2
    },
    {
      group_id = 456
    }
  ]
}
```

<!-- schema generated by tfplugindocs -->
## Schema

### Required

- `deploy_access_levels` (Attributes Set) Array of access levels allowed to deploy, with each described by a hash. Elements in the `deploy_access_levels` should be one of `user_id`, `group_id` or `access_level`. (see [below for nested schema](#nestedatt--deploy_access_levels))
- `environment` (String) The deployment tier of the environment.  Valid values are `production`, `staging`, `testing`, `development`, `other`.
- `group` (String) The ID or full path of the group which the protected environment is created against.

### Optional

- `approval_rules` (Attributes Set) Array of approval rules to deploy, with each described by a hash. Elements in the `approval_rules` should be one of `user_id`, `group_id` or `access_level`. (see [below for nested schema](#nestedatt--approval_rules))

### Read-Only

- `id` (String) The ID of this Terraform resource. In the format of `<group>:<environment-name>`.

<a id="nestedatt--deploy_access_levels"></a>
### Nested Schema for `deploy_access_levels`

Optional:

- `access_level` (String) Levels of access required to deploy to this protected environment. Mutually exclusive with `user_id` and `group_id`. Valid values are `developer`, `maintainer`.
- `group_id` (Number) The ID of the group allowed to deploy to this protected environment. The group must be a sub-group under the given group. Mutually exclusive with `access_level` and `user_id`.
- `group_inheritance_type` (Number) Group inheritance allows deploy access levels to take inherited group membership into account. Valid values are `0`, `1`. `0` => Direct group membership only, `1` => All inherited groups. Default: `0`
- `user_id` (Number) The ID of the user allowed to deploy to this protected environment. The user must be a member of the group with Maintainer role or higher. Mutually exclusive with `access_level` and `group_id`.

Read-Only:

- `access_level_description` (String) Readable description of level of access.
- `id` (Number) The unique ID of the Deploy Access Level object.


<a id="nestedatt--approval_rules"></a>
### Nested Schema for `approval_rules`

Optional:

- `access_level` (String) Levels of access allowed to approve a deployment to this protected environment. Mutually exclusive with `user_id` and `group_id`. Valid values are `developer`, `maintainer`.
- `group_id` (Number) The ID of the group allowed to approve a deployment to this protected environment. TThe group must be a sub-group under the given group. Mutually exclusive with `access_level` and `user_id`.
- `group_inheritance_type` (Number) Group inheritance allows access rules to take inherited group membership into account. Valid values are `0`, `1`. `0` => Direct group membership only, `1` => All inherited groups. Default: `0`
- `required_approvals` (Number) The number of approval required to allow deployment to this protected environment. This is mutually exclusive with user_id.
- `user_id` (Number) The ID of the user allowed to approve a deployment to this protected environment. The user must be a member of the group with Maintainer role or higher. Mutually exclusive with `access_level` and `group_id`.

Read-Only:

- `access_level_description` (String) Readable description of level of access.
- `id` (Number) The unique ID of the Approval Rules object.

## Import

Starting in Terraform v1.5.0 you can use an [import block](https://developer.hashicorp.com/terraform/language/import) to import `gitlab_group_protected_environment`. For example:
```terraform
import {
  to = gitlab_group_protected_environment.example
  id = "see CLI command below for ID"
}
```

Import using the CLI is supported using the following syntax:

```shell
# GitLab group protected environments can be imported using an id made up of `groupId:environmentName`, e.g.
terraform import gitlab_group_protected_environment.bar 123:production
```
